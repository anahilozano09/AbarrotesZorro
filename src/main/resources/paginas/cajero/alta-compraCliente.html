<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="es">
<head th:replace="~{plantillas/plantilla :: head}"></head>
<body>
<header th:replace="~{plantillas/plantilla :: header}"></header>
<main class="container text-center shadow-lg p-3 mt-5 mb-5 bg-body-tertiary rounded">
    <h1>Registrar Compra de Cliente</h1>


    <form th:action="@{/alta-compraCliente/guardar-compra}" th:object="${compra}" method="post">

        <!-- Selección de Cliente -->
        <label for="cliente">Cliente:</label>
        <select id="cliente" name="cliente.id" required>
            <option value="">-- Selecciona un cliente --</option>
            <option th:each="c : ${cliente}"
                    th:value="${c.id}"
                    th:text="${c.nombre + ' - ' + c.numCuenta}">
            </option>
        </select>
        <br/><br/>

        <!-- Selección de Tipo de Producto -->
        <label for="tipoProducto">Tipo de Producto:</label>
        <select id="tipoProducto" name="tipoProducto.id">
            <option value="">-- Selecciona un tipo de producto --</option>
            <option th:each="t : ${tipoProducto}"
                    th:value="${t.id}"
                    th:text="${t.tipo}">
            </option>
        </select>
        <br/><br/>

        <!-- Selección de Producto -->
        <label for="producto">Producto:</label>
        <select id="producto" name="producto.id" required>
            <option value="">-- Selecciona un producto --</option>
        </select>

        <br/><br/>



        <!-- Botón de envío -->
        <button type="submit">Registrar Compra</button>
    </form>
</main>
<footer th:replace="~{plantillas/plantilla :: footer}"></footer>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tipoProductoSelect = document.getElementById("tipoProducto");
        const productoSelect = document.getElementById("producto");

        tipoProductoSelect.addEventListener("change", function () {
            const tipoProductoId = this.value;

            // Limpiar productos actuales
            productoSelect.innerHTML = '<option value="">-- Selecciona un producto --</option>';

            if (tipoProductoId) {
                fetch(`/api/productos?tipoProductoId=${tipoProductoId}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(producto => {
                            const option = document.createElement("option");
                            option.value = producto.id;
                            option.textContent = producto.nombre;
                            productoSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error("Error al cargar productos:", error);
                    });
            }
        });
    });
</script>

</body>
</html>
